---
title: 实验报告——推箱子小游戏
date: 2025-09-09 10:00:00
tags: [小程序开发, 实验]
categories: [小程序]
excerpt: 微信小程序推箱子游戏开发实验报告，详细介绍Canvas绘图API的使用和游戏逻辑实现。
---

## **实验目标**

1. 综合应用所学的知识创建完整的推箱子游戏；
2. 熟练掌握 和绘图 API。

## 实验步骤

#### 创建项目

创建空项目并手动修改页面配置。

<img src="/chunk.github.io/images/屏幕截图 2025-09-08 133509.png" style="zoom:50%;" />

#### 页面配置

###### 创建页面项目

在`app.json `文件中 `pages` 属性添加`“pages/game/game"`，保存后会在`pages`文件夹下自动生成`game`目录。

<img src="/chunk.github.io/images/屏幕截图 2025-09-08 150508.png" style="zoom:50%;" />

###### 删除和修改文件

- 删除`index.wxml`、`index.wxss`和`app.wxss`中的所有代码；

- 删除`index.js`中的所有代码并输入`"page"`使其自动补全函数；

- 删除`app.js`中的所有代码并输入`"app"`使其自动补全函数。

###### 创建其他文件

1. 添加图片文件

   在目录结构中添加`images`文件夹，将游戏页面中需要用到的游戏界面复制进去，并将需要用到的游戏图标素材放在其下的`icons`文件夹中。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 145155.png" style="zoom:50%;" />

2. 创建公共JS文件

   新建`utils`文件夹，在其下新建`data.js`。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 145735.png" style="zoom:50%;" />

#### 视图设计

###### 导航栏设计

在`app.json`文件中修改导航栏效果，将其改为珊瑚红背景白色字体，更改后的代码如图中所示。

<img src="/chunk.github.io/images/屏幕截图 2025-09-08 151114.png" style="zoom:50%;" />

###### 页面设计

1. 公共样式设计

   首先添加页面容器和顶端标题的公共样式，在`app.wxss`中添加如图所示代码。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 151606.png" style="zoom:50%;" />

2. 首页设计

   使`<view>`组件设置首页的标题以及关卡列表的页面设计，首先在`index.wxml`文件中添加如图所示代码，可以看见此时已经成功导入了关卡1的图片，但格式还需要调整；

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 152224.png" style="zoom:50%;" />

   接着在`index.wxss`文件中添加如图所示代码，通过改变图片的尺寸以及`box`组件的排列方式，使第一关只占左边50%。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 152527.png" style="zoom:50%;" />

3. 游戏页面设计

   游戏页面包括游戏关卡标题、游戏画面、方向键和“重新开始”按钮，由于暂时没有做点击跳转的逻辑设计，所以可以在开发工具顶端选择“普通编译”下的“添加编译模式”，并携带临时测试参数 level 0，如图所示，之后预览就可以直接显示 game页面了。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 153616.png" style="zoom:50%;" />

   首先在`game.wxml`文件中添加如图所示代码，成功加入了方向键及重新开始游戏键，但格式还需要进行调整；

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 154655.png" style="zoom:50%;" />

   接着在`game.wxss`文件中添加如下代码，将方向按钮组件纵向排列且居中，同时第二行横向排列，效果如图所示。

   ```javascript
   canvas{
       border: 1rpx solid;
       width: 320px;
       height: 320px;
   }
   .btnBox{
       display: flex;
       flex-direction: column;
       align-items: center;
   }
   .btnBox view{
       display: flex;
       flex-direction: row;
   }
   .btnBox button{
       width: 90rpx;
       height: 90rpx;
   }
   button{
       margin: 10rpx;
   }
   ```

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 154514.png" style="zoom:50%;" />

#### 逻辑实现

###### 公共逻辑

在公共JS文件（`utils/data,js`）中配置游戏地图数据，分别使用map1~map4代表4个不同关卡的地图数据，并分别以二维数组的形式存放，每个位置的数字代表对应的图标素材。

然后需要在`data.js`中使用`module.exports`语句暴露数据出口，并在`game`页面的JS文件端引用该公共逻辑。

> tips：注意小程序在这里暂时还不支持绝对路径引用，只能使用相对路径！

<img src="/chunk.github.io/images/屏幕截图 2025-09-08 160334.png" style="zoom:50%;" />

###### 首页逻辑

1. 关卡列表展示

   在JS文件的`data`中录入关卡图片的数据信息

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 160711.png" style="zoom:50%;" />

   接着为关卡对应的`<view>`组件添加`wx:for`属性循环显示列表数据和图片，效果如图所示。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 161034.png" style="zoom:50%;" />

2. 点击跳转游戏页面

   首先为关卡列表项目添加点击事件，更改`index.wxml`代码，为关卡添加自定义点击事件函数`chooseLevel`，并使用`data-level`属性携带关卡图片下标信息。

   接着在对应的`index.js`文件中添加自定义点击函数的内容，此时以及可以点击跳转到game页面并成功携带了关卡图片数据，但仍需在`game`页面进行携带数据的接受处理才可显示正确的游戏画面。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 161835.png" style="zoom:50%;" />

###### 游戏页逻辑

1. 显示当前第几关

   之前已经实现了页面跳转并携带了关卡对应的图片信息，现在需要在游戏界面接收关卡信息并显示对应的图片内容。

   <img src="/chunk.github.io/images/屏幕截图 2025-09-08 163034.png" style="zoom:50%;" />

2. 游戏逻辑实现

   - 准备工作

     在`game.js`文件的顶端记录一些游戏初始数据信息。

     <img src="/chunk.github.io/images/屏幕截图 2025-09-08 163600.png" style="zoom:50%;" />

   - 初始化游戏画面

     - 在`game.js`文件中添加`initMap`函数，现场从公共函数文件中读取对应关卡的游戏地图数据，然后使用双重for循环对每一块地图数据进行解析并更新当前游戏数据；

       <img src="/chunk.github.io/images/屏幕截图 2025-09-08 164836.png" style="zoom:50%;" />

     - 接着在`game.js`中添加自定义函数`drawCanvas`，将地图信息绘制到画布上；

       <img src="/chunk.github.io/images/屏幕截图 2025-09-08 165406.png" style="zoom:50%;" />

     - 最后在`game.js`的`onLoad`函数中创建画布上下文，并依次调用自定义函数`initMap`和`drawCanvas`。

       <img src="/chunk.github.io/images/屏幕截图 2025-09-08 165814.png" style="zoom:50%;" />

   - 方向键逻辑实现

     - 修改`game.wxml`页面中的4个方向键，为其绑定点击事件；

       <img src="/chunk.github.io/images/屏幕截图 2025-09-08 233501.png" style="zoom:50%;" />

     - 在`game.js`文件中添加上述点击事件函数，分别用于实现游戏主角上下左右的移动，每次点击在条件允许的情况下移动一格。

       <img src="/chunk.github.io/images/屏幕截图 2025-09-08 234601.png" alt="屏幕截图 2025-09-08 234601" style="zoom:50%;" />

3. 判断游戏成功

   - 在`game.js`文件中添加自定义函数`isWin`，用于判断游戏是否已经成功；

     <img src="/chunk.github.io/images/屏幕截图 2025-09-08 235838.png" style="zoom:50%;" />

   - 然后在`game.js`中添加自定义函数`checkWin`，一旦游戏成功就弹出提示对话框；

     <img src="/chunk.github.io/images/屏幕截图 2025-09-08 234645.png" style="zoom:50%;" />

   - 最后在`game.js`的4个方向键函数中追加关于游戏成功判断的函数。

     <img src="/chunk.github.io/images/屏幕截图 2025-09-08 234645.png" style="zoom:50%;" />

## 程序运行结果

推箱子小游戏可以正常运行，具有以下功能：

1. 关卡选择：首页显示4个不同关卡，点击可进入对应游戏
2. 游戏操作：通过方向键控制角色移动，推动箱子到指定位置
3. 游戏判断：当所有箱子都推到目标位置时，弹出胜利提示
4. 重新开始：可以重置当前关卡重新游戏

## 问题总结与体会

### 学习收获

1. Canvas绘图技能：深入学习了微信小程序中Canvas组件的使用，掌握了基本的绘图API；

2. 游戏开发思维：通过开发推箱子游戏，学会了如何将复杂的游戏逻辑分解为简单的函数模块，提高了编程的逻辑思维能力。

3. 事件处理机制：学习了小程序中的事件绑定和处理机制，特别是自定义事件函数的编写和参数传递。

