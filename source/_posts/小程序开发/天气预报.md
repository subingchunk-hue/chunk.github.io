---
title: 实验报告——天气预报
date: 2025-08-26 17:07:00
tags: [小程序开发, 实验]
categories: [小程序]
---

## 实验目标

1、掌握服务器域名配置和临时服务器部署；

2、掌握 wx.request 接口的用法。

## 实验步骤

#### 准备工作

1. 申请API密钥

   - 选择可以提供全球气象数据服务s接口的和风天气API，首先进入官方网址，输入邮箱免费注册；

     <img src="/chunk.github.io/images/image-20250826082930902.png" alt="实验结果" style="zoom: 33%;" />   

     <img src="/chunk.github.io/images/image-20250826083128319.png" style="zoom: 25%;" />

   - 注册完成后访问控制台查看账号信息，依据官方文档成功生成API KEY，记录该key。（API KEY可以用于在小程序发出网络请求时作为身份识别的标识一起发送给和风天气的第三方服务器）

     <img src="/chunk.github.io/images/image-20250826085659494.png" style="zoom: 50%;" />

2. 调用API

   - 取出在和风天气中的API KEY及API Host

   - 访问[https://mn5xmd96fj.re.qweatherapi.com//v7/weather/now?location=101010100&key=f40427d91c8c43a9a7db17aede262b09](https://mn5xmd96fj.re.qweatherapi.com//v7/weather/now?location=101010100&key=f40427d91c8c43a9a7db17aede262b09)。

     > weather关键字代表获取实况天气，基于weather的接口有两个必填参数，分别为city和key，其中，city表示要查询的城市，此处选取城市ID为主要参数，key即为开发者的API KEY。

   <img src="/chunk.github.io/images/image-20250826140547601.png" style="zoom:50%;" />

3. 服务器域名配置

   登录微信公众平台，进入小程序管理员后台，在“开发设置面板”的“服务器域名”中添加或修改所需要的网络通信的服务器域名地址。此小程序主要需要添加的为request合法域名，即为开发者在和风天气中的API Host。

   <img src="/chunk.github.io/images/image-20250826100200164.png" style="zoom:50%;" />

#### 小程序开发

###### 项目创建

在微信开发者工具新建空项目。

<img src="/chunk.github.io/images/image-20250826100730046.png" alt="image-20250826100730046" style="zoom:33%;" />

###### 页面配置

1. 创建页面文件

   在根目录下生成文件夹pages存放页面文件，首页默认为index。

   <img src="/chunk.github.io/images/image-20250826101006438.png" style="zoom:50%;" />

2. 删除和修改文件

   - 删除`utils`文件夹及其所有内容；

   - 删除`pages`文件夹下的`logs`目录及其所有内容；

   - 删除`index.wxml`、`index.wxss`和`app.wxss`的所有代码；

   - 删除`index.js`的全部代码，输入关键词"page"自动补全函数；

   - 删除的`app.js`的所有代码，输入关键词"app"自动补全函数。

     <img src="/chunk.github.io/images/image-20250826101308791.png" style="zoom: 33%;" />  
     <img src="/chunk.github.io/images/image-20250826101345252.png" style="zoom:33%;" />

3. 创建其他文件

   本项目还需要一个文件夹用存放天气图标素材，素材均来自于和风天气官网。在根目录下新建images文件夹及其子文件夹weather_icon，将图片文件全部复制进去。（需要注意的是，为了使图片更加覆盖各种天气，这里下载的是和风天气官网提供的完整zip，但图片格式为`.svg`）

   <img src="/chunk.github.io/images/image-20250826141142734.png" style="zoom: 50%;" />

###### 视图设计

1. 导航栏设计

   更改`app.json`文件将导航栏标题和背景改为自定义颜色。

   图中所示代码改为蓝色背景色，预览效果如图。

   <img src="/chunk.github.io/images/image-20250826102930658.png" style="zoom:33%;" />

2. 页面设计

   > 本小程序页面主要包含4个区域：
   >
   > 1. 区域1： 地区选择器，用户可以自行选择查询的省、市、区；
   > 2. 区域2： 显示当前城市的温度和天气状态的文字说明；
   > 3. 区域3： 显示当前城市的天气图标；
   > 4. 区域4： 分多行显示其他天气信息，如湿度、气压、能见度和风向。
   
   具体使用的组件如下：
   
   - `<view>`
   - `<picker>`
   - `<image>`
   
   首先，定义页面的容器`container`并在`app.wxss`中设置容器样式，包括高度、布局、是否居中以及间距。
   
   <img src="/chunk.github.io/images/image-20250826103312691.png" alt="image-20250826103312691" style="zoom:33%;" />
   
   接着，添加各种组件元素。
   
   - 区域1：使用`<picker>`组件完成，用户可以点击切换其他城市，组件内部随意填写一个城市名称（相当于默认城市），当点击城市名称时会从底部弹出控件让用户进行省、市、区的选择；
   
     <img src="/chunk.github.io/images/image-20250826103530348.png" style="zoom: 50%;" />
   
   - 区域2：主要是进行文字的设计，包括当前城市的温度和天气状况；
   
     <img src="/chunk.github.io/images/image-20250826103748981.png" style="zoom:50%;" />
   
   - 区域3：将天气图标导入（由于文件中下载的是`.svg`的图标，因此在image组件内部必须注意要写为：`/images/weather_icon/1.svg`)；
   
     <img src="/chunk.github.io/images/image-20250826104114273.png" style="zoom: 33%;" />
   
   - 区域4：展示多行天气信息，使用`detail`，接着定义需要的单元行（`bar`），在每行内部定义单元格(`box`)。
   
     <img src="/chunk.github.io/images/image-20250826105124992.png" alt="image-20250826105124992" style="zoom: 33%;" />

###### 逻辑实现

1. 更新省、市、区信息

   将`picker`组件中的具体省份改为`{{region}}`，接着为该组件追加自定义的`bindchange`事件，用于监听选项变化；

   <img src="/chunk.github.io/images/image-20250826144726629.png" alt="image-20250826144726629" style="zoom:50%;" />

   由于地区选择器的返回结果是数组的形式，因此在JS文件的data中定义一个包含省、市、区三个项目的数组，初始信息由开发者自己定义。

   ![image-20250826105504046](/chunk.github.io/images/image-20250826105504046.png)

2. 获取实况天气数据

   在JS文件中添加自定义`getWeather`函数进行实况天气数据的获取，后续的天气查询以城市作为查询依据。

   <img src="/chunk.github.io/images/image-20250826145104775.png" alt="image-20250826145104775" style="zoom:50%;" />

   将定义的`getWeather`函数在生命周期函数`onLoad`和`regionChange`中分别调用，表示当页面加载时和切换城市时均主动获取一次实况天气数据。

   <img src="/chunk.github.io/images/image-20250826150017775.png" alt="image-20250826150017775" style="zoom:50%;" />

   编译后重新运行会在控制台得到第三方服务器发挥的JSON数据，如图所示。

   <img src="/chunk.github.io/images/image-20250826111501997.png" alt="image-20250826111501997" style="zoom:50%;" />

3. 更新页面天气信息

   将WXML页面上的所有零食数据都替换成`{{now.属性}}`的形式，为了加快获取数据的速度，最好在IS文件的`data`中为`now`规定初始数据，在获取到实际数据之前可以临时显示这些数据。

   <img src="/chunk.github.io/images/image-20250826150403170.png" alt="image-20250826150403170" style="zoom:50%;" />

   <img src="/chunk.github.io/images/image-20250826150557076.png" alt="image-20250826150557076" style="zoom:50%;" />

## 程序运行结果

可以成功获取动态获取各城市天气： 
<img src="/chunk.github.io/images/image-20250826131959017.png" alt="image-20250826131959017" style="zoom:33%;" />        
<img src="/chunk.github.io/images/image-20250826131934346.png" alt="image-20250826131934346" style="zoom:33%;" />

## 问题总结与体会

##### 主要问题及解决方案

1. API配置问题

   - 问题：URL地址不完整，域名未加入白名单

   - 解决：配置完整API地址，在小程序后台添加域名白名单

2. 参数格式错误

   - 问题：使用城市名称而非城市代码

   - 解决：建立城市名称到代码的映射关系

3. 数据字段不匹配

   - 问题：API返回字段与代码期望字段不一致

   - 解决：修正字段映射关系

4. 图标格式错误

   - 问题：代码引用`PNG`格式，实际为`SVG`格式

   - 解决：修改图标路径为正确的`SVG`格式

5. 缺少动态更新

   - 问题：`location`参数硬编码，无法动态切换城市

   - 解决：实现`getCityCode`函数，支持动态城市代码获取

##### 主要收获

1. 微信小程序开发技能
   - 学会了picker组件的多级联动，支持省市区三级选择
   - 理解了数据绑定机制和`setData`的使用方法
   - 更加熟悉小程序的生命周期函数（`onLoad`、`onShow`等）
2. 网络编程与API集成
   - 学会了使用`wx.request`接口，了解API及服务器域名配置
   - 掌握了JSON数据的解析和字段映射技巧
3. 调试与问题解决能力
   - 熟练使用微信开发者工具的调试功能和网络面板
   - 掌握了系统性的问题分析方法：问题定位→原因分析→解决方案→验证测试
   - 提升了阅读官方文档和API文档的能力